<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="DogWalkerApp.Views.DashboardPage"
             Title="Dashboard">

    <Grid>
        <ScrollView>
            <VerticalStackLayout Spacing="16" Padding="20">
                <Label Text="Friends with Fur"
                       FontSize="28"
                       FontAttributes="Bold"
                       TextColor="{DynamicResource Primary}" />

            <Frame BackgroundColor="{AppThemeBinding Light=#f1f5f9, Dark=#1f2937}"
                   Padding="16"
                   CornerRadius="12">
                <VerticalStackLayout>
                    <Label Text="Today"
                           FontAttributes="Bold"
                           FontSize="18" />
                    <Label Text="{Binding StatusMessage}"
                           FontSize="14"
                           TextColor="{DynamicResource Secondary}" />
                </VerticalStackLayout>
            </Frame>

            <Label Text="Quick Services"
                   FontAttributes="Bold"
                   FontSize="18" />

            <CollectionView ItemsSource="{Binding ServiceOptions}"
                            SelectionMode="None">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" Span="2" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:ServiceOption"
                                  xmlns:models="clr-namespace:DogWalkerApp.Models">
                        <Frame Padding="12"
                               Margin="4"
                               CornerRadius="14"
                               BackgroundColor="{AppThemeBinding Light=#ffffff, Dark=#111827}"
                               Shadow="Medium">
                            <VerticalStackLayout>
                                <Label Text="{Binding Title}"
                                       FontSize="16"
                                       FontAttributes="Bold" />
                                <Label Text="{Binding Description}"
                                       FontSize="13"
                                       TextColor="{DynamicResource Secondary}"
                                       LineBreakMode="WordWrap" />
                                <Label Text="{Binding Price, StringFormat='${0:F0}'}"
                                       FontSize="14"
                                       Margin="0,4,0,8" />
                                <Button Text="Book"
                                        Command="{Binding Source={RelativeSource AncestorType=ContentPage}, Path=BindingContext.QuickBookCommand}"
                                        CommandParameter="{Binding}"
                                        HorizontalOptions="Fill" />
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Label Text="Upcoming Walks"
                   FontAttributes="Bold"
                   FontSize="18" />

            <CollectionView ItemsSource="{Binding UpcomingBookings}"
                            HeightRequest="280"
                            SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="dto:BookingDto"
                                  xmlns:dto="clr-namespace:DogWalker.Core.DTOs;assembly=DogWalker.Core">
                        <Frame Padding="14"
                               Margin="0,6"
                               CornerRadius="12"
                               BorderColor="#e2e8f0">
                            <Grid ColumnDefinitions="*,Auto"
                                  RowDefinitions="Auto,Auto">
                                <Label Grid.ColumnSpan="2"
                                       Text="{Binding ServiceType}"
                                       FontAttributes="Bold" />
                                <Label Grid.Row="1"
                                       Text="{Binding StartTimeUtc, StringFormat='{}{0:MMM dd â€¢ h:mm tt}'}"
                                       FontSize="13"
                                       TextColor="{DynamicResource Secondary}" />
                                <Label Grid.Row="1"
                                       Grid.Column="1"
                                       Text="{Binding Status}"
                                       FontSize="13"
                                       TextColor="#0ea5e9" />
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            </VerticalStackLayout>
        </ScrollView>

        <ActivityIndicator IsRunning="{Binding IsBusy}"
                           IsVisible="{Binding IsBusy}"
                           Color="{DynamicResource Primary}"
                           VerticalOptions="Center"
                           HorizontalOptions="Center" />
    </Grid>
</ContentPage>
